<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MN End to End Workflow</title>
<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
	<div class="container">
		<header>
			<h1>MN End to End Workflow</h1>
			<div class="user-info">
				<span>Raja Murugan</span> <span>Role (Analyst)</span>
			</div>
		</header>
		<div class="content">
			<div class="left-panel">
				<button id="changeFileBtn" onclick="showPanel('changeFile')">Change
					File Generator</button>
				<button id="peerReviewBtn" onclick="showPanel('peerReview')">Peer
					Review Validator</button>
				<button id="impactReportBtn" onclick="showPanel('impactReport')">Impact
					Report Generator</button>
			</div>
			<div class="right-panel">
				<div id="changeFile" class="panel hidden">
					<h3>Change File Generator</h3>
				</div>

				<div id="peerReview" class="panel hidden">
					<h3>Select Env</h3>
					<select>
						<option value="sit">SIT</option>
						<option value="dev">DEV</option>
					</select>

					<h3>Select Change File</h3>
					<input type="file" id="changeFileInput" title="Browse for file" accept=".xls,.xlsx">

					<button class="validate-btn" onclick="validatePeerReview()">Validate</button>
				</div>

				<div id="impactReport" class="panel hidden">
					<h3>Impact Report Generator</h3>
				</div>
			</div>
		</div>
	</div>

	<script>
    function showPanel(panelId) {
        // Hide all panels
        document.querySelectorAll('.panel').forEach(panel => {
            panel.classList.add('hidden');
        });

        // Show the selected panel
        const panelToShow = document.getElementById(panelId);
        if (panelToShow) {
            panelToShow.classList.remove('hidden');
        }
    }

    function validatePeerReview() {
        let fileInput = document.getElementById('changeFileInput');
        let selectedFile = fileInput.files[0];

        if (!selectedFile) {
            alert("Please select a file before validating.");
            return;
        }

        let formData = new FormData();
        formData.append("file", selectedFile);

        fetch('/peer-review/validate', {
            method: 'POST',
            body: formData
        }).then(response => {
            if (!response.ok) {
                throw new Error('Validation failed');
            }
            return response.json();
        }).then(data => {
            alert("File validation complete: " + JSON.stringify(data));
        }).catch(error => {
            console.error("Error during validation:", error);
            alert("Validation failed. Please try again.");
        });
    }
	</script>
</body>
</html>
