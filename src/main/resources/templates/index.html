<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MN End to End Workflow</title>
<link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
	<div class="container">
		<header>
			<h1>MN End to End Workflow</h1>
			<div class="user-info">
				<span>Raja Murugan</span> <span>Role (Analyst)</span>
			</div>
		</header>
		<div class="content">
			<div class="left-panel">
				<button id="changeFileBtn" onclick="showPanel('changeFile')">Change
					File Generator</button>
				<button id="peerReviewBtn" onclick="showPanel('peerReview')">Peer
					Review Validator</button>
				<button id="impactReportBtn" onclick="showPanel('impactReport')">Impact
					Report Generator</button>
			</div>
			<div class="right-panel">
				<div id="changeFile" class="panel hidden">
					<h3>Change File Generator</h3>
					<!-- Additional content for Change File Generator can be added here -->
				</div>

				<!-- Peer Review Validator Panel -->
				<div id="peerReview" class="panel hidden">
					<h3>Select Environment</h3>
					<select id="envSelect">
						<option value="SIT">SIT</option>
						<option value="DEV">DEV</option>
						<!-- Add more environments if needed -->
					</select>

					<h3>Select Change File</h3>
					<input type="file" id="fileInput" title="Browse for file" accept=".xls,.xlsx">

					<button class="validate-btn" onclick="validatePeerReview()">Validate</button>

					<div id="resultMessage"></div>
				</div>

				<div id="impactReport" class="panel hidden">
					<h3>Impact Report Generator</h3>
					<!-- Additional content for Impact Report Generator can be added here -->
				</div>
			</div>
		</div>
	</div>

	<script>
        function showPanel(panelId) {
            // Hide all panels
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.add('hidden');
            });

            // Show the selected panel
            document.getElementById(panelId).classList.remove('hidden');
        }

        function validatePeerReview() {
            const fileInput = document.getElementById('fileInput');
            const envSelect = document.getElementById('envSelect');
            const resultMessage = document.getElementById('resultMessage');

            if (fileInput.files.length === 0) {
                alert('Please select a file to validate.');
                return;
            }

            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);  // Append the file to the FormData
            formData.append('environment', envSelect.value);  // Append the environment

            // Send the file and environment to the back-end via AJAX
            fetch('/peer-review/validate', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())  // Parse the response as text
            .then(data => {
                resultMessage.innerHTML = `<p>${data}</p>`;  // Display the result message
            })
            .catch(error => {
                console.error('Error:', error);
                resultMessage.innerHTML = '<p style="color: red;">Validation failed. Please try again.</p>';
            });
        }
    </script>
</body>
</html>
